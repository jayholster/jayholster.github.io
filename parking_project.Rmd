---
title: "The Impact of Parking Permit Ownership on Academic Outcomes"
author: "Jacob Holster, Finn Bender, Dr. Eric Vance"
date: "6/12/2020"
output:
  pdf_document: default
  html_document:
    df_print: paged
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r 1, include=FALSE}
library(lavaan)
library(semPlot)
library(psych)
library(aod)
library(ggplot2)
library(ggpubr)
library(dplyr)
library(plyr)
library(scales)
library(rstatix)
library(stringr)
library(knitr)
library(rmarkdown)
all <- read.csv('all.csv')
allpop <- read.csv('allunderclassmen.csv')
replacement <- read.csv('replacement.csv')
parking.r <- factor(replacement$Parking_Pop)
parking.f <- factor(allpop$Parking_Pop)
class.f <- factor(allpop$Class_Level)
all$Class_Level <- factor(all$Class_Level, levels = c("Freshman", "Sophomore", "Junior","Senior"))
allpop$Class_Level <- factor(allpop$Class_Level, levels = c("Freshman", "Sophomore", "Junior","Senior"))
```
# Background
The domain experts expressed curiosity about the relationship between parking permit status and student learning outcomes (SLOs) such as retention and academic achievement. Further, they were interested in using their large volume of data to craft parking policy.

They indicated an interest in testing the hypotheses that parking permit ownership might impact SLOs. Before arriving at any specific research goals, the domain experts expressed their belief that parking services provide access to campus for students. This conversation allowed several sub-research questions to emerge, and solidify into the following inquiry:

How is student parking permit status related to student performance and retention? 

### Variables of Interest
* **Parking_Pop**: Denotes whether the student was found in the parking dataset (1 or 0). 
* **Term_Hours**: Count of hours taken within a given semester. 
* **Term_GPA:** Final GPA for the measured semester. 
* **Cumulative_GPA**: Final GPA for all classes up until a given semester. 
* **Dropped**: If true, indicates that the term found was the last term that student took classes. If the student also did not graduate, they are assumed to have dropped out. (1 or 0). 
* **Complete**: Indicates whether the student graduated or not. (1 or 0). 

# Results
Parking permit ownership directly predicts retention and Term_GPA. Term_GPA in particular is a consistent predictor of retention across class levels. The effect of owning a parking permit is beneficial in terms of Term_GPA and retention to freshmen, sophomores, juniors, and noticably less so for seniors. Initial descriptive statistics, as displayed in boxplot form in the figure below, support the notion that owning a parking permit is associated with positive impacts on Term_GPA, as there are gains for median Term_GPA results, represented by the black bar in the center of the boxes, and mean Term_GPA results, represented by the white dot inside each box with alongside white labeling text. 

```{r descriptiveplot, echo = TRUE, message = F, warning = F}
ggplot(allpop, aes(x = Class_Level, y = Term_GPA, fill = parking.f)) +
  geom_boxplot() + 
  stat_summary(fun.y="mean", geom="point", size=3, 
      position=position_dodge(width=0.75), color="white") +
  stat_summary(fun.y=mean, colour="white", geom="text", 
      position=position_dodge(width =  0.75),show_guide = FALSE, vjust=-2.1,
      aes(label=round(..y.., digits=2)))
```

### Choosing a Representative Population
The population was derived from data collected by CU parking services, as well as data on academic performance obtained from the CU Office of Data Analytics (ODA). In total, there were 593,781 observations of 124,383 unique students between 2010 and 2020. Student data was anonymized by a third-party representative of ODA. 

To limit outliers in the sample, non-degree seeking students and students who were seeking degrees on other campuses were removed from the dataset. A distance variable was computed using ZIP codes from both the parking and academic datasets. Students who lived within 45 miles of campus were retained for the final dataset, and all others were dropped. This was a relatively arbitrary decision, based on the distance of cities such as Aurora to the South, Ft. Collins to the North and Brighton to the east. 

After outliers were removed, there were observations of 39,678 Freshmen, 46,451 Sophomores, 50,933 Juniors, and 56,590 Seniors in the analyzed dataset (n = 193,652).

### Modeling Theoretical Relationships in the Data

Structural equation models (SEM) were constructed in order to comprehensively investigate connections between variables for each class_level group: (Freshmen, Sophomores, Juniors, Seniors). The benefit of SEM is that all relationships can be modeled and compared across groups in an iterative process of fine tuning the models. The initial equations in the code below are indicative of the following theories: 

1. Drop out rates are connected to Term_GPA, Term_Hours, distance, and parking permit status. 
2. Term_GPA is connected to both parking permit status and Term_Hours. 
These possible relationships are visualized below, with each arrow representing a linear regression. The overall purpose of this hypothetical model is to explore the possible connections between the available factors in the dataset. Specifically, we are interested in the interaction between parking permit status, term GPA, and the variable dropped, due to the initial descriptive output in the figure above. 

```{r allmodels, echo = TRUE}
model <- '
    dropped ~ Term_GPA + Term_Hours + distance + Parking_Pop
    Term_GPA ~ Parking_Pop + Term_Hours
'
fit <- sem(model, group = 'Class_Level', data=allpop)
semPaths(fit, nCharNodes = 0, combineGroups = TRUE, rotation = 2)
```

### Fine Tuning the Models

After examining initial results, not all paths proved significant. The significant paths remain in the model, visualized below, describing these theoretical relationships in the data: 

1. Dropping out has a connection to Term_GPA. 
2. Term_GPA is connected to parking permit status.

Distance did not hold any significant relationship to other variables in the model across class levels, which led to the removal of distance from the final model. Term hours also explained an insufficient amount of variance in any other variable to be included in the trimmed model. 

```{r trimmedmodel, echo = TRUE, message = F, warning = F}
model <- '
    dropped ~ Term_GPA
    Term_GPA ~ Parking_Pop
'
fit <- sem(model, group = 'Class_Level',data=allpop)
semPaths(fit, nCharNodes = 0, combineGroups = TRUE, rotation = 2)
```

### Measuring Differences by Class Level
The same model was run for each class level, and the hypotheses were compared between groups in order to address the research question "Is parking permit status beneficial to freshmen, vs. other class levels?" The results from the final structural equation model are in the table below, where the numbers are indicative of an effect size, or the impact of this certain relationship given a particular class level. 

```{r modeldiff, message = F, warning = F, echo = FALSE}
modeldiff <- read.csv('semresults.csv')
kable(head(modeldiff))
```

### Translating SEM Output into Meaningful Results
These models demonstrate that the data are well represented, however they do not indicate the clear and practical benefits of having a parking permit. In order to do this, linear regressions were run to establish coefficient weights, which help to better understand the impacts of parking permit ownership on drop out rates and term gpa alone.

### Term Grade Point Average
Regressions were also run to establish the extent to which parking permit owners in each class level might receive benefits in Term_GPA. The trends for Term_GPA largely follow the dropout rate results, with freshmen and sophomores who own a parking permit enjoying the largest increases in Term_GPA (+0.14, +0.13), with smaller impacts for juniors (+0.08) and seniors (+0.03). 

```{r termgpa, echo = TRUE, message = F, warning = F}
allpop$Term_GPA_Increase <- allpop$Parking_Pop
model2 <- dlply(allpop, "Class_Level", function(df) 
  lm(Term_GPA ~ Term_GPA_Increase, data = df))
kable(head(ldply(model2, coef)))
```

### Dropout Rates
Four linear regressions were run in order to demonstrate the extent to the effect of parking permit ownership has on drop out rate, as well as the variance of this effect across class levels. Freshmen enjoy the largest percent decrease in dropout rates (-2.1%), while sophomores also see a signficant decrease (-1.6%). The impact is lessened for upperclassmen, where junior and senior drop out rates decreased less than a percent (-0.8% and -0.5%, respectively). 

```{r dropoutrates, layout="l-body-outset", echo = TRUE, message = F, warning = F}
allpop$Dropout_Rate_Decrease <- allpop$Parking_Pop
model1 <- dlply(allpop, "Class_Level", function(df) 
  lm(dropped ~ Dropout_Rate_Decrease, data = df))
kable(head(ldply(model1,(coef))))
```


# Discussion
It is clear that, on average, undergraduates who own parking permits experience benefits for Term_GPA and have lower drop out rates. As college freshmen are the most susceptible population for dropping out, an improvement of 2.2% can make a difference for thousands of students. In terms of the analyzed sample, 872 freshmen at the University of Colorado Boulder who were at risk of dropping may have been retained as a result of owning a parking permit over the past decade. 

In the more stringent, replacement sampling model, Term_GPA benefits were stronger, with a 0.16 GPA point increase for on average for parking permit owning freshmen, and a 0.15 GPA increase for sophomores. The drop out rate is also improved to a greater extent in the replacement model, as freshmen drop out rates were decreased by 2.6%, which would reflect the support of the academic outcomes of 1031 freshmen since 2010. 

### A Note on Generalizability  
It is less clear whether parking permit ownership is the key lever in these apparent academic supports. While the relationships between the discussed variables are consistent across sampling techniques and model structures, strict causality can not be established due to weaknesses in static group analysis, namely the interaction between selection and maturation of subjects. For instance, Term_GPA is calculated at the end of the semester, while parking permit decisions are typically made months beforehand. Students are involved in many events over the course of a term, including the use of parking permits. It is possible that the benefits that students experience in Term_GPA may be due to factors other than parking permit ownership that occur throughout the semester. These include, but are not limited to, extracurricular activities, sports, clubs, as well as academic experiences and outcomes. 

To make defensible arguments for external validity, or the extent to which we can generalize the findings from this study to the entire population of CU undergraduates, data were modeled using the entire dataset (population), and two subsets, and were subsequently compared in analysis.

The two subsamples included random sampling without replacement with equal groups (based on Parking_Pop), and sampling with replacement to ensure the effect was not conflated with duplicate students in the dataset. Sampling procedures indicated that the model shows the best fit when the entire population is utilized in analysis (where CFI should be above 0.95, and RMSEA should be below 0.08), and that there were no major abberations in analysis when taking a more rigorous sampling approach. For these two reasons, all findings are generalizable to the entire population of students at CU Boulder from the beginning of 2010 to the end of 2019. 

```{r samples, message = F, warning = F, echo = FALSE}
pop <- read.csv('population.csv')
kable(head(pop))
```

### Data Limitations: Individual Differences
Additionally, the lack of the presence of multiple extraneous variables weakens the generalizability of the practical implications. Individual differences are the individualized elements that participants bring to a study. These individual differences are often financial, social, and are typically measured as part of a student's demographic profile. Socioeconomic status is one powerful extraneous variable that we were not able to test alongside parking permit ownership and academic outcomes. Socioeconomic status may prove to correlate highly with parking permit ownership, and thus, correlate positively with Term_GPA.

Due to limits in data collection, there were several questions the researchers posed which we were unable to answer at this time. Parking permit type data was not sufficient for analysis, therefore clarifications are needed in terms of permit number prefixes, in order to convert enough permit numbers to permit type for a sufficiently powered analysis. 

The impact of distance was not significant in the models presented in this study. That, however, does rule out a relationship between distance, parking permit ownership, and academic success. Distance was converted from confounded address data, as students do not always report their actual address, can live with their parents, or have a number of living situations which are not represented accurately by their ZIP code alone. In order to understand the role of distance in this research context, more accurate data are needed on a representative sample of students, perhaps in the form of a targeted survey. 

Other questions that were not addressed include the benefit of parking permits in comparison to alternative ways of accessing campus. We were unable to procure data on alternate ways of accessing campus in the present study. 

### Insight on Next Steps in Statistical Analysis 
There are two distinct, yet complimentary directions for future research, one being to develop a more robust dataset that represents students' campus experiences in a holistic way. For instance, data on club participation, other extracurricular activities, additional avenues of transportation to campus, accurate local addresses, accurate permanent addresses, and socioeconomic factors might be appended to the present dataset. If more variables are added, statistical analyses on parking data would have more power and more generalizability. Further, a more comprehensive dataset might allow other research questions to be answered, as the University of Colorado Boulder will continue to be invested in understanding their student body in terms of academic outcomes. 

Another complementary direction is to construct a controlled quasi-experimental study, where students are assessed on their parking and academic habits both before and multiple times during a term. Using careful sampling procedures and a stronger experimental design, where the effect of parking permit ownership can be replicated with and without other causal variables, it may be possible to say with certainty that the GPA and retention benefits students experience are in part due to the fact that they own a parking permit. Nevertheless, within this large dataset are signals of a significant connection between parking permit ownership and academic success. 


